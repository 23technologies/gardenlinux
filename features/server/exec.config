systemctl enable systemd-networkd
systemctl enable systemd-timesyncd
systemctl enable systemd-resolved
systemctl enable ssh-keygen
systemctl enable tmp.mount
#systemctl enable ssh-moduli

for i in $(ls /boot | grep vmlinuz | sed "s/vmlinuz-//"); do
	systemctl enable kexec-load@$i
done

update-ca-certificates
addgroup --system wheel

ln -sf /bin/ip /usr/bin/ip
sed -i "s/#RuntimeWatchdogSec=0/RuntimeWatchdogSec=20s/g" /etc/systemd/system.conf

chmod 0440 /etc/sudoers.d/wheel

echo "### Deleting libdb forcefully"
apt-get autoremove --purge -y libdb5.3

# fix file system permissions for higher security
chmod u-s /sbin/mount.nfs /sbin/mount.cifs /bin/umount /bin/mount
chmod g-w / /etc/hosts

# remove python's __pycache__
find /usr/lib -type d -name __pycache__ -exec rm -rf {} +

# CVE CVE-2021-23841
wget --quiet -P /tmp http://snapshot-cache.ci.gardener.cloud/archive/debian/20210217T023442Z/pool/main/o/openssl/openssl_1.1.1j-1_amd64.deb
apt-get install -y -f /tmp/openssl_1.1.1j-1_amd64.deb
rm /tmp/openssl_1.1.1j-1_amd64.deb
